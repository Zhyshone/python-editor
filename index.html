<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Python Code Editor</title>

<!-- CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>

<!-- Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.0/full/pyodide.js"></script>

<style>
:root {
  --bg: #0f1113;
  --panel: #1b1d1f;
  --muted: #9aa5b1;
  --green: #00ff88;
  --accent: #0e84d4;
}
html,body {height:100%;margin:0;font-family:Inter, Arial, sans-serif;background:var(--bg);color:#ddd;}
.container{display:flex;height:100vh;}
.left{width:50%;display:flex;flex-direction:column;border-right:1px solid #222;background: var(--panel);}
.right{width:50%;display:flex;flex-direction:column;background:#0b0c0d;}
.titlebar{display:flex;justify-content:space-between;padding:10px;background:#151617;border-bottom:1px solid #222;}
.title-left{display:flex;flex-direction:column;}
.title-left .title{font-weight:600;font-size:16px;color:#fff;margin:0;}
.title-left .author{font-size:12px;color:var(--muted);margin-top:3px;}
.title-right{display:flex;align-items:center;gap:8px;}
.btn{border:none;padding:7px 12px;border-radius:6px;cursor:pointer;font-weight:600;}
.btn-run{background:#0e8b3b;color:#fff;}
.btn-clear{background:transparent;color:#fff;border:1px solid #333;display:flex;align-items:center;justify-content:center;width:32px;height:32px;font-size:16px;padding:0;}
.editor-area{flex:1;display:flex;}
.CodeMirror{height:100%;width:100%;font-size:14px;background:#0f1113;color:#ddd;}
.console-header{padding:10px;border-bottom:1px solid #111;color:var(--muted);}
.console{flex:1;padding:12px;font-family:"Courier New", monospace;font-size:13px;overflow:auto;white-space:pre-wrap;background:#0b0c0d;color:var(--green);}
.console-input-wrap{display:flex;gap:8px;margin-top:4px;}
.console-input{flex:1;padding:6px 8px;border-radius:6px;border:1px solid #222;background:#111;color:#fff;font-family:monospace;}
.console-submit{padding:6px 10px;border-radius:6px;border:none;background:#0e84d4;color:#fff;cursor:pointer;}
</style>
</head>
<body>
<div class="container">
  <div class="left">
    <div class="titlebar">
      <div class="title-left">
        <div class="title">Python Code Editor v.1.5</div>
        <div class="author">by: Engr. Godofredo L. Jipus Jr</div>
      </div>
      <div class="title-right">
        <button class="btn btn-run" id="runBtn">Run â–¶</button>
        <button class="btn btn-clear" id="clearBtn">ðŸ—‘</button>
      </div>
    </div>
    <div class="editor-area">
      <textarea id="code">
# Example:
num = input("Enter a number: ")
print("You entered:", num)
      </textarea>
    </div>
  </div>

  <div class="right">
    <div class="console-header">Console</div>
    <div id="console" class="console"></div>
  </div>
</div>

<script>
const consoleEl = document.getElementById('console');
let pyodide = null;
let pyodideReady = false;

// Utilities
function appendConsole(text){consoleEl.textContent += text; consoleEl.scrollTop = consoleEl.scrollHeight;}
function appendConsoleLine(text=''){appendConsole(text+'\n');}
function clearConsole(){consoleEl.textContent='';}

// Input machinery
function createConsoleInput(prompt=''){
  return new Promise(resolve=>{
    appendConsole(prompt);
    const wrapper = document.createElement('div');
    wrapper.className='console-input-wrap';
    const input=document.createElement('input');
    input.className='console-input';
    const btn=document.createElement('button');
    btn.className='console-submit';
    btn.textContent='Enter';
    function submit(){
      const val=input.value;
      appendConsoleLine(val);
      wrapper.remove();
      resolve(val+'\n');
    }
    btn.addEventListener('click', submit);
    input.addEventListener('keydown', e=>{
      if(e.key==='Enter') submit();
    });
    wrapper.appendChild(input);
    wrapper.appendChild(btn);
    consoleEl.appendChild(wrapper);
    input.focus();
    consoleEl.scrollTop = consoleEl.scrollHeight;
  });
}

// Initialize CodeMirror
const editor = CodeMirror.fromTextArea(document.getElementById('code'),{
  mode:'python', theme:'dracula', lineNumbers:true, indentUnit:4, tabSize:4
});
editor.setSize('100%','100%');

// Load Pyodide
async function initPyodide(){
  appendConsoleLine("Loading Python runtime...");
  pyodide = await loadPyodide();
  pyodideReady = true;

  pyodide.setStdout({batched: msg=>appendConsole(msg)});
  pyodide.setStderr({batched: msg=>appendConsole(msg)});

  // JS async input for Python
  pyodide.setStdin({readline: createConsoleInput});

  appendConsoleLine("Python ready.\n");
}
initPyodide();

// Run button: executes entire editor code
document.getElementById('runBtn').addEventListener('click', async ()=>{
  if(!pyodideReady){appendConsoleLine("Python still loading..."); return;}
  appendConsoleLine('--- Running program ---');
  const code = editor.getValue();
  try{
    await pyodide.runPythonAsync(code);
  }catch(err){
    appendConsoleLine('Error:\n'+err);
  }
  appendConsoleLine('--- Program finished ---\n');
});

// Clear button
document.getElementById('clearBtn').addEventListener('click', clearConsole);
</script>
</body>
</html>
