<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Python Editor â€” Terminal</title>

<!-- CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>

<!-- Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.0/full/pyodide.js"></script>

<style>
:root {
  --bg: #0f1113;
  --panel: #1b1d1f;
  --muted: #9aa5b1;
  --accent: #0e84d4;
  --green: #00ff88;
}
html,body { height:100%; margin:0; font-family: Inter, Arial, sans-serif; background:var(--bg); color:#ddd; }
.container { display:flex; height:100vh; gap:0; }

.left { width:50%; display:flex; flex-direction:column; border-right:1px solid #222; background: var(--panel); }
.titlebar { display:flex; align-items:center; justify-content:space-between; padding:10px 14px; background:#151617; border-bottom:1px solid #222; }
.title-left .title { font-weight:600; font-size:16px; color:#fff; margin:0; }
.title-left .author { font-size:12px; color:var(--muted); margin-top:3px; }
.title-right { display:flex; align-items:center; gap:8px; }
.btn { border:none; padding:7px 12px; border-radius:6px; cursor:pointer; font-weight:600; font-size:14px; }
.btn-run { background:#0e8b3b; color:#fff; }
.btn-clear { background:transparent; color:#fff; border:1px solid #333; padding:6px 10px; }

.editor-area { flex:1; display:flex; }
.CodeMirror { height:100%; width:100%; font-size:14px; background:#0f1113; color:#ddd; }

.right { width:50%; display:flex; flex-direction:column; background:#0b0c0d; }
.console-header { padding:10px 12px; border-bottom:1px solid #111; color:var(--muted); font-size:13px; background:#0b0c0d; }
.console { flex:1; padding:12px; font-family:"Courier New", monospace; font-size:13px; color:var(--green); overflow:auto; white-space: pre-wrap; outline:none; caret-color:var(--green); }

@media (max-width:900px) { .container { flex-direction:column; } .left, .right { width:100%; height:50vh; } }
</style>
</head>
<body>
<div class="container">
  <!-- LEFT: Editor -->
  <div class="left">
    <div class="titlebar">
      <div class="title-left">
        <div class="title">Python Code Editor</div>
        <div class="author">by: Engr. Godofredo L. Jipus Jr</div>
      </div>
      <div class="title-right">
        <button class="btn btn-run" id="runBtn">Run â–¶</button>
        <button class="btn btn-clear" id="clearBtn">ðŸ—‘</button>
      </div>
    </div>
    <div class="editor-area">
      <textarea id="code" spellcheck="false">
# Example: input works inline like terminal
num = input("Enter a number: ")
print("You entered:", num)
      </textarea>
    </div>
  </div>

  <!-- RIGHT: Console -->
  <div class="right">
    <div class="console-header">Terminal</div>
    <div id="console" class="console" contenteditable="true"></div>
  </div>
</div>

<script>
const consoleEl = document.getElementById('console');
let inputResolve = null;
let inputBuffer = '';

function appendConsole(text) {
  consoleEl.textContent += text;
  consoleEl.scrollTop = consoleEl.scrollHeight;
}

// Append text but keep user cursor at the end
function appendConsoleLine(text='') {
  appendConsole(text + '\n');
  placeCaretAtEnd(consoleEl);
}

function placeCaretAtEnd(el) {
  el.focus();
  if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
    const range = document.createRange();
    range.selectNodeContents(el);
    range.collapse(false);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  }
}

/* Initialize CodeMirror */
const textarea = document.getElementById('code');
const editor = CodeMirror.fromTextArea(textarea, {
  mode: 'python',
  theme: 'dracula',
  lineNumbers: true,
  indentUnit: 4,
  tabSize: 4,
  autofocus: true
});
editor.setSize('100%', '100%');

/* Load Pyodide */
let pyodideReady = false;
let pyodide = null;

async function initPyodide() {
  appendConsoleLine('Loading Python runtime...');
  pyodide = await loadPyodide();
  pyodideReady = true;

  pyodide.setStdout({ batched: msg => appendConsole(msg) });
  pyodide.setStderr({ batched: msg => appendConsole(msg) });

  pyodide.setStdin({
    readline: async () => {
      return new Promise(resolve => {
        inputResolve = resolve;
        inputBuffer = '';
        placeCaretAtEnd(consoleEl);
      });
    }
  });

  appendConsoleLine('Python ready.\n');
}
initPyodide();

/* Capture key events for inline input */
consoleEl.addEventListener('keydown', (e) => {
  if (!inputResolve) return; // only capture during input
  if (e.key === 'Enter') {
    e.preventDefault();
    appendConsoleLine('');
    inputResolve(inputBuffer + '\n');
    inputResolve = null;
  } else if (e.key === 'Backspace') {
    e.preventDefault();
    if (inputBuffer.length > 0) {
      inputBuffer = inputBuffer.slice(0, -1);
      consoleEl.textContent = consoleEl.textContent.slice(0, -1);
      placeCaretAtEnd(consoleEl);
    }
  } else if (e.key.length === 1) {
    e.preventDefault();
    inputBuffer += e.key;
    appendConsole(e.key);
  }
});

/* Run / Clear */
const runBtn = document.getElementById('runBtn');
const clearBtn = document.getElementById('clearBtn');

async function runCode() {
  if (!pyodideReady) {
    appendConsoleLine('Python still loading...');
    return;
  }

  appendConsoleLine('--- Running program ---\n');
  try {
    const code = editor.getValue();
    await pyodide.runPythonAsync(code);
  } catch (err) {
    appendConsoleLine('Error:\n' + err + '\n');
  }
  appendConsoleLine('--- Program finished ---\n');
}

function clearConsole() {
  consoleEl.textContent = '';
}

runBtn.addEventListener('click', runCode);
clearBtn.addEventListener('click', clearConsole);
</script>
</body>
</html>
