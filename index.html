<!-- CodeMirror CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>

<!-- Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.0/full/pyodide.js"></script>

<style>
  .editor-container {
    margin-top: 10px;
  }

  .editor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px;
    background: #eee;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  .editor-title {
    font-size: 18px;
  }

  .editor-buttons button {
    cursor: pointer;
    border: none;
    padding: 6px 12px;
    margin-left: 6px;
    border-radius: 6px;
    font-size: 14px;
  }

  .btn-run {
    background: #28a745;
    color: white;
  }

  .btn-clear {
    background: #dc3545;
    color: white;
    font-size: 16px;
    padding: 6px 10px;
  }

  .layout-box {
    display: flex;
    height: 480px;
    border: 1px solid #ccc;
    border-radius: 8px;
    overflow: hidden;
    margin-top: 10px;
  }

  .left-panel {
    width: 50%;
    border-right: 1px solid #ccc;
  }

  .right-panel {
    width: 50%;
    background: #111;
    color: #0f0;
    padding: 10px;
    overflow: auto;
    font-family: monospace;
  }
</style>

<!-- Top Title -->
<div style="font-family: Arial;">
  <strong style="font-size:22px;">Python Code Editor</strong><br>
  <small>by: Engr. Godofredo L. Jipus Jr</small>
</div>

<div class="editor-container">

  <!-- Code Editor Header -->
  <div class="editor-header">
    <div class="editor-title">Write your Python code below:</div>
    <div class="editor-buttons">
      <button class="btn-run" onclick="runPython()">â–¶ Run</button>
      <button class="btn-clear" onclick="clearOutput()">ðŸ§¹</button>
    </div>
  </div>

  <!-- Editor + Output Panel -->
  <div class="layout-box">
    <div class="left-panel">
      <textarea id="code-area">print("Hello from Canvas!")</textarea>
    </div>

    <pre id="output" class="right-panel">Loading Python...</pre>
  </div>

</div>

<script>
let pyodide = null;
let editor;

// Initialize CodeMirror (light theme)
editor = CodeMirror.fromTextArea(document.getElementById("code-area"), {
    mode: "python",
    theme: "default",
    lineNumbers: true,
    indentUnit: 4,
    tabSize: 4
});

// Load Pyodide + stdout, stderr, input()
async function loadPy() {
    pyodide = await loadPyodide();

    pyodide.setStdout({
        batched: (msg) => {
            document.getElementById("output").textContent += msg;
        }
    });

    pyodide.setStderr({
        batched: (msg) => {
            document.getElementById("output").textContent += msg;
        }
    });

    pyodide.setStdin({
        readline: () => {
            const value = prompt("Python input:");
            return value === null ? "" : value;
        }
    });

    document.getElementById("output").textContent = "Python ready.\n";
}

loadPy();

// Run Python Code
async function runPython() {
    if (!pyodide) {
        document.getElementById("output").textContent = "Python loadingâ€¦";
        return;
    }

    document.getElementById("output").textContent = "";
    const code = editor.getValue();

    try {
        await pyodide.runPythonAsync(code);
    } catch (err) {
        document.getElementById("output").textContent += "\nError:\n" + err;
    }
}

// Clear Output
function clearOutput() {
    document.getElementById("output").textContent = "";
}
</script>
