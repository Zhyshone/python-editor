<!-- CodeMirror CSS (Light & Dark Themes) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>

<!-- Pyodide (Python Runtime) -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.0/full/pyodide.js"></script>

<style>
  .editor-wrapper {
    display: flex;
    border: 1px solid #ccc;
    height: 480px;
    margin-top: 10px;
  }
  .left-panel {
    width: 50%;
    border-right: 1px solid #ccc;
    display: flex;
    flex-direction: column;
  }
  .right-panel {
    width: 50%;
    background: #111;
    color: #0f0;
    padding: 10px;
    overflow: auto;
    font-family: monospace;
    font-size: 14px;
  }
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #eee;
    padding: 10px;
    border-radius: 8px;
  }
  .topbar.dark {
    background: #222;
    color: white;
  }
  .btn {
    padding: 6px 12px;
    font-size: 14px;
    border: none;
    margin-left: 5px;
    cursor: pointer;
    border-radius: 6px;
  }
  .btn-run { background: #28a745; color: white; }
  .btn-clear { background: #dc3545; color: white; }
  .btn-toggle { background: #007bff; color: white; }
</style>

<div class="topbar" id="topbar">
  <div>
    <strong style="font-size:18px;">Python Code Editor</strong><br>
    <small>by: Engr. Godofredo L. Jipus Jr</small>
  </div>
  <div>
    <button class="btn btn-run" onclick="runPython()">▶ Run</button>
    <button class="btn btn-clear" onclick="clearOutput()">Clear Output</button>
    <button class="btn btn-toggle" onclick="toggleTheme()">Toggle Theme</button>
  </div>
</div>

<div class="editor-wrapper">
  <div class="left-panel">
    <textarea id="code-area">print("Hello from Canvas Python Editor!")</textarea>
  </div>

  <pre id="output" class="right-panel">Loading Python...</pre>
</div>

<script>
let pyodide = null;
let editor;
let darkMode = false;

// Initialize CodeMirror
editor = CodeMirror.fromTextArea(document.getElementById("code-area"), {
    mode: "python",
    theme: "default",
    lineNumbers: true,
    indentUnit: 4,
    tabSize: 4
});

// Load Pyodide
async function loadPy() {
    pyodide = await loadPyodide();

    pyodide.setStdout({
        batched: (msg) => {
            document.getElementById("output").textContent += msg;
        }
    });
    pyodide.setStderr({
        batched: (msg) => {
            document.getElementById("output").textContent += msg;
        }
    });

    document.getElementById("output").textContent = "Python ready.\n";
}

loadPy();

// Run Python Code
async function runPython() {
    if (!pyodide) {
        document.getElementById("output").textContent = "Python loading…";
        return;
    }

    document.getElementById("output").textContent = "";
    const code = editor.getValue();

    try {
        await pyodide.runPythonAsync(code);
    } catch (err) {
        document.getElementById("output").textContent += "\nError:\n" + err;
    }
}

// Clear Output
function clearOutput() {
    document.getElementById("output").textContent = "";
}

// Toggle Light/Dark Theme
function toggleTheme() {
    darkMode = !darkMode;

    const topbar = document.getElementById("topbar");
    const output = document.getElementById("output");

    if (darkMode) {
        editor.setOption("theme", "dracula");
        output.style.background = "#000";
        output.style.color = "#0f0";
        topbar.classList.add("dark");
    } else {
        editor.setOption("theme", "default");
        output.style.background = "#111";
        output.style.color = "#0f0";
        topbar.classList.remove("dark");
    }
}
</script>
